<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF-è§†é¢‘æ˜¾ç¤ºå™¨</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .navbar .nav-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .navbar .nav-controls {
            display: flex;
            gap: 15px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .upload-btn,
        .control-btn,
        .preview-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .preview-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
        }

        .preview-btn.active {
            background: linear-gradient(45deg, #dc3545, #c82333);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
            }

            50% {
                box-shadow: 0 4px 25px rgba(220, 53, 69, 0.6);
            }

            100% {
                box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
            }
        }

        .control-btn {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #dee2e6;
        }

        .control-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .fullscreen-btn {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
            font-size: 16px;
            padding: 10px 15px;
        }

        .fullscreen-btn:hover {
            background: linear-gradient(45deg, #138496, #117a8b);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.6);
        }

        /* PPTå®¹å™¨æ ·å¼ */
        .ppt-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            height: calc(100vh - 80px);
            /* å‡å»å¯¼èˆªæ é«˜åº¦ */
            min-height: 600px;
            overflow: hidden;
            position: relative;
        }

        .ppt-viewer {
            flex: 1;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
            min-height: 500px;
            width: 100%;
        }

        .ppt-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        }

        .ppt-placeholder .placeholder-content {
            text-align: center;
            color: #666;
        }

        .ppt-placeholder .placeholder-content h2 {
            margin-bottom: 15px;
            font-size: 28px;
            color: #333;
        }

        .ppt-placeholder .placeholder-content p {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .ppt-placeholder .placeholder-content .format-tip {
            font-size: 14px;
            color: #28a745;
            margin-bottom: 30px;
            font-weight: 500;
            background: rgba(40, 167, 69, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
        }

        .ppt-slide {
            width: 100%;
            height: 100%;
            display: none;
        }

        .ppt-slide.active {
            display: block;
        }

        .ppt-slide img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: white;
        }

        .ppt-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 25px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            height: 50px;
            transition: all 0.3s ease;
        }

        /* å…¨å±æ¨¡å¼ä¸‹çš„PPTæ§åˆ¶æ æ ·å¼ */
        .ppt-container.fullscreen .ppt-controls {
            position: fixed;
            bottom: -45px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 25px 25px 0 0;
            padding: 15px 30px 20px 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            transition: bottom 0.3s ease;
        }

        .ppt-container.fullscreen .ppt-controls:hover {
            bottom: 0px;
        }

        /* å…¨å±æ¨¡å¼ä¸‹çš„æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .ppt-container.fullscreen .ppt-controls .control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .ppt-container.fullscreen .ppt-controls .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .ppt-container.fullscreen .ppt-controls .slide-counter {
            color: white;
        }

        .ppt-controls .slide-counter {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            min-width: 80px;
            text-align: center;
        }

        /* æ‚¬æµ®è§†é¢‘çª—å£æ ·å¼ */
        .video-window {
            position: fixed;
            top: 100px;
            right: 30px;
            width: 350px;
            height: 220px;
            background: #000;
            border-radius: 8px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            overflow: hidden;
            transition: all 0.3s ease;
            display: none;
            resize: both;
            min-width: 200px;
            min-height: 150px;
            max-width: 1200px;
            max-height: 800px;
            border: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* å…¨å±é¢„è§ˆæ—¶çš„è§†é¢‘çª—å£æ ·å¼ */
        .video-window.fullscreen-preview {
            position: absolute !important;
            z-index: 1000 !important;
            border-radius: 12px !important;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            display: block !important;
            resize: both !important;
            min-width: 200px !important;
            min-height: 150px !important;
            max-width: 80vw !important;
            max-height: 80vh !important;
        }

        .video-window.fullscreen-preview .video-controls {
            opacity: 0;
        }

        .video-window.fullscreen-preview:hover .video-controls {
            opacity: 1;
        }

        .video-window:hover {
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
        }

        .video-window.minimized {
            height: 40px;
            resize: none;
        }


        .video-window.dragging {
            transform: scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .video-header {
            position: absolute;
            top: 0;
            right: 0;
            padding: 8px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            border: none;
            z-index: 10;
        }

        .video-header .video-controls {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: auto;
        }

        .video-window:hover .video-controls {
            opacity: 1;
        }

        .video-header .video-controls button {
            width: 28px;
            height: 28px;
            border: none;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        .video-header .video-controls button:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }

        .video-header .video-controls .close-btn:hover {
            background: rgba(255, 0, 0, 0.8);
        }

        .video-header .video-controls .drag-btn {
            cursor: grab;
            font-size: 12px;
            font-weight: bold;
        }

        .video-header .video-controls .drag-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            cursor: grabbing;
        }

        .video-window video {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            background: #000;
            outline: none;
            border: none;
            display: block;
            object-fit: contain;
        }

        .video-window video:focus {
            outline: none;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .modal-header .close-btn {
            width: 30px;
            height: 30px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            transition: all 0.2s ease;
        }

        .modal-header .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 25px;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .upload-text p {
            margin-bottom: 10px;
        }

        .upload-text p:first-child {
            font-size: 18px;
            font-weight: 500;
            color: #333;
        }

        .upload-text .upload-hint {
            font-size: 14px;
            color: #666;
        }

        .file-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item .file-name {
            font-size: 14px;
            color: #333;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-item .file-remove {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .file-item .file-remove:hover {
            background: #c82333;
        }

        /* åŠ¨ç”» */
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .navbar {
                padding: 10px 20px;
            }

            .navbar .nav-title {
                font-size: 20px;
            }

            .navbar .nav-controls {
                gap: 10px;
            }

            .ppt-container {
                padding: 15px;
            }

            .video-window {
                width: 300px;
                height: 200px;
                right: 15px;
                top: 80px;
            }

            .modal .modal-content {
                width: 95%;
            }

            .modal-header {
                padding: 15px 20px;
            }

            .modal-body {
                padding: 20px;
            }
        }

        /* æ–‡ä»¶è¾“å…¥æ ‡ç­¾æ ·å¼ */
        .file-input-label {
            display: block;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label input[type="file"] {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* æ‹–æ‹½æ‚¬åœçŠ¶æ€ */
        .upload-area.dragover {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.1);
            transform: scale(1.02);
        }

        /* æ–‡ä»¶åˆ—è¡¨æ ·å¼ */
        .file-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            gap: 10px;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .file-item span {
            font-size: 14px;
            color: #333;
        }

        .file-item .file-size {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }

        .file-item .file-type {
            font-size: 12px;
            color: #ff6b6b;
            font-weight: bold;
            background: rgba(255, 107, 107, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* ä¸Šä¼ æç¤ºæ ·å¼ */
        .upload-alert {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            border-radius: 8px;
            color: #856404;
        }

        .upload-alert .alert-content h4 {
            margin-bottom: 10px;
            color: #856404;
            font-size: 16px;
        }

        .upload-alert .alert-content p {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .upload-alert .alert-content ul {
            margin-left: 20px;
            line-height: 1.6;
        }

        .upload-alert .alert-content li {
            margin-bottom: 5px;
        }

        /* PPTXæŸ¥çœ‹å™¨æ ·å¼ */
        .viewer-selector {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px;
            text-align: center;
        }

        .viewer-selector h3 {
            margin-bottom: 30px;
            color: #333;
            font-size: 24px;
        }

        .viewer-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .viewer-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .viewer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .viewer-note {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 15px;
        }

        /* æŸ¥çœ‹å™¨å†…å®¹æ ·å¼ */
        .office-viewer,
        .google-viewer {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid #e0e0e0;
        }

        .viewer-header h4 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .back-btn {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .viewer-content {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
        }

        .viewer-content p {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            line-height: 1.6;
        }

        .viewer-content ol {
            margin: 20px 0;
            text-align: left;
            max-width: 400px;
        }

        .viewer-content li {
            margin-bottom: 10px;
            color: #555;
            line-height: 1.5;
        }

        .download-btn {
            padding: 12px 30px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        /* éšè—æ ·å¼ */
        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="nav-title">PDF-è§†é¢‘æ˜¾ç¤ºå™¨</div>
            <div class="nav-controls">
                <button class="upload-btn" onclick="openPPTUpload()">ä¸Šä¼ PDF</button>
                <button class="upload-btn" onclick="openVideoUpload()">ä¸Šä¼ è§†é¢‘</button>
                <button class="preview-btn" onclick="togglePreview()">é¢„è§ˆ</button>
            </div>
        </nav>

        <!-- PPTå±•ç¤ºåŒºåŸŸ -->
        <div class="ppt-container">
            <div class="ppt-viewer" id="pptViewer">
                <div class="ppt-placeholder">
                    <div class="placeholder-content">
                        <h2>è¯·ä¸Šä¼ PDFæ–‡ä»¶</h2>
                        <p>æ”¯æŒæ ¼å¼ï¼šå›¾ç‰‡ï¼ˆJPG, PNG, GIFï¼‰ã€PDFï¼ˆå¯ç¿»é¡µï¼‰</p>
                        <p class="format-tip">ğŸ’¡ æš‚ä¸æ”¯æŒPPTXã€PPTæ ¼å¼ï¼Œè¯·å°†PPTå¦å­˜ä¸ºPDFæ ¼å¼</p>
                        <button class="upload-btn" onclick="openPPTUpload()">é€‰æ‹©PDFæ–‡ä»¶</button>
                    </div>
                </div>
            </div>

            <!-- PPTæ§åˆ¶æ  -->
            <div class="ppt-controls">
                <button class="control-btn" onclick="previousSlide()">ä¸Šä¸€é¡µ</button>
                <span class="slide-counter">
                    <span id="currentSlide">1</span> / <span id="totalSlides">1</span>
                </span>
                <button class="control-btn" onclick="nextSlide()">ä¸‹ä¸€é¡µ</button>
                <!-- <button class="control-btn fullscreen-btn" onclick="toggleFullscreenPreview()" title="å…¨å±é¢„è§ˆ">â›¶</button> -->
            </div>

            <!-- æ‚¬æµ®è§†é¢‘çª—å£ -->
            <div class="video-window" id="videoWindow">
                <div class="video-header">
                    <div class="video-controls">
                        <button class="drag-btn" title="æ‹–åŠ¨">â‹®â‹®</button>
                        <button class="minimize-btn" onclick="toggleVideoSize()">-</button>
                        <button class="close-btn" onclick="closeVideo()">Ã—</button>
                    </div>
                </div>
                <video id="lectureVideo" controls>
                    <source src="" type="video/mp4">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                </video>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ä¸Šä¼ æ–‡ä»¶</h3>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <label for="fileInput" class="file-input-label">
                        <input type="file" id="fileInput" multiple accept="" onchange="handleFileUpload(event)">
                        <div class="upload-text">
                            <p>æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»é€‰æ‹©</p>
                            <p class="upload-hint">æ”¯æŒå¤šä¸ªæ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€PPTXã€PPTã€PDF</p>
                        </div>
                    </label>
                </div>
                <div class="file-list" id="fileList"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let pptImages = [];
        let currentSlideIndex = 0;
        let isVideoMinimized = false;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let pdfDocument = null;
        let isPdfMode = false;
        let isPreviewMode = false;
        let previewInterval = null;

        // æ‰“å¼€PPTä¸Šä¼ æ¨¡æ€æ¡†
        function openPPTUpload() {
            const modal = document.getElementById('uploadModal');
            const modalTitle = document.getElementById('modalTitle');
            const fileInput = document.getElementById('fileInput');
            const uploadHint = document.querySelector('.upload-hint');

            modalTitle.textContent = 'ä¸Šä¼ PDFæ–‡ä»¶';
            fileInput.accept = 'image/*,.pdf';
            fileInput.setAttribute('data-type', 'ppt');
            fileInput.multiple = true; // PDFæ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ 

            // æ›´æ–°ä¸Šä¼ æç¤º
            uploadHint.textContent = 'æ”¯æŒå¤šä¸ªæ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ…æ‹¬å›¾ç‰‡ã€PDFï¼ˆPDFæœ€å¤§500MBï¼‰';

            modal.style.display = 'flex';
        }

        // æ‰“å¼€è§†é¢‘ä¸Šä¼ æ¨¡æ€æ¡†
        function openVideoUpload() {
            const modal = document.getElementById('uploadModal');
            const modalTitle = document.getElementById('modalTitle');
            const fileInput = document.getElementById('fileInput');
            const uploadHint = document.querySelector('.upload-hint');

            modalTitle.textContent = 'ä¸Šä¼ è§†é¢‘æ–‡ä»¶';
            fileInput.accept = 'video/*,.mp4,.mov,.avi,.mkv,.wmv,.flv,.webm';
            fileInput.setAttribute('data-type', 'video');
            fileInput.multiple = false; // è§†é¢‘åªæ”¯æŒå•æ–‡ä»¶ä¸Šä¼ 

            // æ›´æ–°ä¸Šä¼ æç¤º
            uploadHint.textContent = 'æ”¯æŒè§†é¢‘æ ¼å¼ï¼šMP4, MOV, AVI, MKV, WMV, FLV, WebMï¼ˆæœ€å¤§2GBï¼‰';

            modal.style.display = 'flex';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            const modal = document.getElementById('uploadModal');
            const fileList = document.getElementById('fileList');
            modal.style.display = 'none';
            fileList.innerHTML = '';
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(event) {
            const files = event.target.files;
            const fileType = event.target.getAttribute('data-type');
            const fileList = document.getElementById('fileList');

            fileList.innerHTML = '';

            if (fileType === 'ppt') {
                handlePPTUpload(files);
            } else if (fileType === 'video') {
                handleVideoUpload(files);
            }
        }

        // å¤„ç†PPTæ–‡ä»¶ä¸Šä¼ 
        function handlePPTUpload(files) {
            pptImages = [];
            const fileList = document.getElementById('fileList');
            let imageFiles = [];
            let pptxFiles = [];

            Array.from(files).forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';

                if (file.type.startsWith('image/')) {
                    imageFiles.push(file);
                    fileItem.innerHTML = `
                <span>${file.name}</span>
                <span class="file-size">${(file.size / 1024).toFixed(1)}KB</span>
            `;
                } else if (file.name.endsWith('.pptx') || file.name.endsWith('.ppt') || file.type.includes('powerpoint')) {
                    // æš‚ä¸æ”¯æŒPPTæ ¼å¼
                    fileItem.innerHTML = `
                 <span>${file.name}</span>
                 <span class="file-size">${(file.size / 1024 / 1024).toFixed(1)}MB</span>
                 <span class="file-type">æš‚ä¸æ”¯æŒ</span>
             `;
                } else if (file.type === 'application/pdf') {
                    // PDFæ–‡ä»¶å¤„ç†
                    handlePDFFile(file);
                    fileItem.innerHTML = `
                 <span>${file.name}</span>
                 <span class="file-size">${(file.size / 1024 / 1024).toFixed(1)}MB</span>
                 <span class="file-type">PDFæ–‡ä»¶</span>
             `;
                } else {
                    fileItem.innerHTML = `
                <span>${file.name}</span>
                <span class="file-size">${(file.size / 1024).toFixed(1)}KB</span>
                <span class="file-type">ä¸æ”¯æŒçš„æ ¼å¼</span>
            `;
                }

                fileList.appendChild(fileItem);
            });

            // å¤„ç†å›¾ç‰‡æ–‡ä»¶
            if (imageFiles.length > 0) {
                imageFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        pptImages.push({
                            src: e.target.result,
                            name: file.name
                        });

                        // å¦‚æœæ˜¯æœ€åä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œæ˜¾ç¤ºPPT
                        if (pptImages.length === imageFiles.length) {
                            displayPPT();
                            setTimeout(() => {
                                closeModal();
                            }, 1000);
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }

            // å¦‚æœæ²¡æœ‰ä»»ä½•å¯å¤„ç†çš„æ–‡ä»¶ï¼Œæ˜¾ç¤ºæç¤º
            if (imageFiles.length === 0) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'upload-alert';
                alertDiv.innerHTML = `
             <div class="alert-content">
                 <h4>âš ï¸ ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼</h4>
                 <p>è¯·ä¸Šä¼ ä»¥ä¸‹æ ¼å¼çš„æ–‡ä»¶ï¼š</p>
                 <ul>
                     <li>å›¾ç‰‡æ–‡ä»¶ï¼šJPG, PNG, GIF</li>
                     <li>PDFæ–‡ä»¶ï¼šPDF</li>
                     <li>æš‚ä¸æ”¯æŒï¼šPPTX, PPTæ ¼å¼</li>
                 </ul>
             </div>
         `;
                fileList.appendChild(alertDiv);
            }
        }

        // å¤„ç†è§†é¢‘ä¸Šä¼ 
        function handleVideoUpload(files) {
            const file = files[0];
            const fileList = document.getElementById('fileList');

            if (!file) {
                alert('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('video/')) {
                alert('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶æ ¼å¼');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º2GBï¼‰
            const maxSize = 2 * 1024 * 1024 * 1024; // 2GB
            if (file.size > maxSize) {
                alert('è§†é¢‘æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2GB');
                return;
            }

            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
        <span>${file.name}</span>
        <span class="file-size">${(file.size / 1024 / 1024).toFixed(1)}MB</span>
        <span class="file-type">æ­£åœ¨åŠ è½½...</span>
    `;
            fileList.appendChild(fileItem);

            // åˆ›å»ºè§†é¢‘URL
            const videoURL = URL.createObjectURL(file);

            const video = document.getElementById('lectureVideo');
            const videoWindow = document.getElementById('videoWindow');

            // è®¾ç½®è§†é¢‘æº
            video.src = videoURL;
            videoWindow.style.display = 'block';

            // ç›‘å¬è§†é¢‘åŠ è½½äº‹ä»¶
            video.addEventListener('loadedmetadata', function () {
                const duration = Math.floor(video.duration);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;

                // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
                const fileTypeSpan = fileItem.querySelector('.file-type');
                fileTypeSpan.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                fileTypeSpan.style.color = '#28a745';

                console.log('è§†é¢‘åŠ è½½æˆåŠŸï¼Œæ—¶é•¿:', `${minutes}:${seconds.toString().padStart(2, '0')}`);
            });

            // ç›‘å¬è§†é¢‘åŠ è½½é”™è¯¯
            video.addEventListener('error', function () {
                alert('è§†é¢‘åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                const fileTypeSpan = fileItem.querySelector('.file-type');
                fileTypeSpan.textContent = 'åŠ è½½å¤±è´¥';
                fileTypeSpan.style.color = '#dc3545';
            });

            // åˆå§‹åŒ–è§†é¢‘çª—å£æ‹–æ‹½åŠŸèƒ½
            initVideoWindow();

            // å»¶è¿Ÿå…³é—­æ¨¡æ€æ¡†
            setTimeout(() => {
                closeModal();
            }, 1500);
        }

        // å¤„ç†PDFæ–‡ä»¶
        function handlePDFFile(file) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º500MBï¼‰
            const maxSize = 500 * 1024 * 1024; // 500MB
            if (file.size > maxSize) {
                alert('PDFæ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡500MB');
                return;
            }

            const fileURL = URL.createObjectURL(file);

            // è®¾ç½®PDF.jsçš„worker
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

            // åŠ è½½PDF
            pdfjsLib.getDocument(fileURL).promise.then(function (pdf) {
                pdfDocument = pdf;
                isPdfMode = true;
                currentSlideIndex = 0;

                // æ˜¾ç¤ºPDF
                displayPDF();

                // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
                setTimeout(() => {
                    closeModal();
                }, 500);
            }).catch(function (error) {
                console.error('PDFåŠ è½½å¤±è´¥:', error);
                alert('PDFæ–‡ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå');
            });
        }

        // å¤„ç†PPTXæ–‡ä»¶
        function processPPTXFiles(pptxFiles) {
            const file = pptxFiles[0]; // å–ç¬¬ä¸€ä¸ªPPTXæ–‡ä»¶

            // åˆ›å»ºä¸´æ—¶URL
            const fileURL = URL.createObjectURL(file);

            // æ˜¾ç¤ºPPTXæ–‡ä»¶
            displayPPTX(fileURL, file.name);
        }

        // æ˜¾ç¤ºPPTXæ–‡ä»¶
        function displayPPTX(fileURL, fileName) {
            const pptViewer = document.getElementById('pptViewer');
            pptViewer.innerHTML = '';

            // åˆ›å»ºé€‰æ‹©å™¨è®©ç”¨æˆ·é€‰æ‹©æŸ¥çœ‹æ–¹å¼
            const viewerSelector = document.createElement('div');
            viewerSelector.className = 'viewer-selector';
            viewerSelector.innerHTML = `
        <h3>é€‰æ‹©æŸ¥çœ‹æ–¹å¼</h3>
        <div class="viewer-options">
            <button class="viewer-btn" onclick="showOfficeViewer('${fileURL}', '${fileName}')">
                Office Online æŸ¥çœ‹
            </button>
            <button class="viewer-btn" onclick="showGoogleViewer('${fileURL}', '${fileName}')">
                Google Docs æŸ¥çœ‹
            </button>
            <button class="viewer-btn" onclick="showDownloadOption('${fileURL}', '${fileName}')">
                ä¸‹è½½æŸ¥çœ‹
            </button>
        </div>
        <p class="viewer-note">æ³¨æ„ï¼šåœ¨çº¿æŸ¥çœ‹å™¨éœ€è¦å°†æ–‡ä»¶ä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡</p>
    `;

            pptViewer.appendChild(viewerSelector);

            // æ›´æ–°é¡µç æ˜¾ç¤º
            document.getElementById('currentSlide').textContent = '1';
            document.getElementById('totalSlides').textContent = '1';
        }

        // ä½¿ç”¨Office OnlineæŸ¥çœ‹å™¨
        function showOfficeViewer(fileURL, fileName) {
            const pptViewer = document.getElementById('pptViewer');
            pptViewer.innerHTML = `
        <div class="office-viewer">
            <div class="viewer-header">
                <h4>${fileName}</h4>
                <button class="back-btn" onclick="location.reload()">è¿”å›</button>
            </div>
            <div class="viewer-content">
                <p>æ­£åœ¨å‡†å¤‡Office OnlineæŸ¥çœ‹å™¨...</p>
                <p>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·é€‰æ‹©ä»¥ä¸‹æ–¹å¼ï¼š</p>
                <ol>
                    <li>ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°æŸ¥çœ‹</li>
                    <li>ä¸Šä¼ åˆ°OneDriveåä½¿ç”¨Office Online</li>
                    <li>ä½¿ç”¨æœ¬åœ°Officeè½¯ä»¶æ‰“å¼€</li>
                </ol>
                <button class="download-btn" onclick="downloadFile('${fileURL}', '${fileName}')">
                    ä¸‹è½½æ–‡ä»¶
                </button>
            </div>
        </div>
    `;
        }

        // ä½¿ç”¨Google DocsæŸ¥çœ‹å™¨
        function showGoogleViewer(fileURL, fileName) {
            const pptViewer = document.getElementById('pptViewer');
            pptViewer.innerHTML = `
        <div class="google-viewer">
            <div class="viewer-header">
                <h4>${fileName}</h4>
                <button class="back-btn" onclick="location.reload()">è¿”å›</button>
            </div>
            <div class="viewer-content">
                <p>æ­£åœ¨å‡†å¤‡Google DocsæŸ¥çœ‹å™¨...</p>
                <p>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·é€‰æ‹©ä»¥ä¸‹æ–¹å¼ï¼š</p>
                <ol>
                    <li>ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°æŸ¥çœ‹</li>
                    <li>ä¸Šä¼ åˆ°Google Driveååˆ†äº«æŸ¥çœ‹</li>
                    <li>ä½¿ç”¨æœ¬åœ°Officeè½¯ä»¶æ‰“å¼€</li>
                </ol>
                <button class="download-btn" onclick="downloadFile('${fileURL}', '${fileName}')">
                    ä¸‹è½½æ–‡ä»¶
                </button>
            </div>
        </div>
    `;
        }

        // æ˜¾ç¤ºä¸‹è½½é€‰é¡¹
        function showDownloadOption(fileURL, fileName) {
            downloadFile(fileURL, fileName);
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(fileURL, fileName) {
            const a = document.createElement('a');
            a.href = fileURL;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // æ˜¾ç¤ºPDF
        function displayPDF() {
            if (!pdfDocument) return;

            const pptViewer = document.getElementById('pptViewer');

            // æ£€æŸ¥æ˜¯å¦å·²æœ‰canvaså®¹å™¨ï¼Œå¦‚æœæ²¡æœ‰æ‰åˆ›å»º
            let canvasContainer = pptViewer.querySelector('.pdf-canvas-container');
            if (!canvasContainer) {
                pptViewer.innerHTML = '';

                // å¼ºåˆ¶åˆ·æ–°å®¹å™¨å°ºå¯¸
                pptViewer.style.display = 'flex';
                pptViewer.style.width = '100%';
                pptViewer.style.height = '100%';

                // åˆ›å»ºcanvaså®¹å™¨
                canvasContainer = document.createElement('div');
                canvasContainer.className = 'pdf-canvas-container';
                canvasContainer.style.width = '100%';
                canvasContainer.style.height = '100%';
                canvasContainer.style.display = 'flex';
                canvasContainer.style.alignItems = 'center';
                canvasContainer.style.justifyContent = 'center';
                canvasContainer.style.overflow = 'visible';
                canvasContainer.style.position = 'relative';
                canvasContainer.style.padding = '0';
                canvasContainer.style.margin = '0';

                pptViewer.appendChild(canvasContainer);
            }

            // ç­‰å¾…DOMæ›´æ–°ï¼Œç„¶åè·å–å®é™…å°ºå¯¸
            setTimeout(() => {
                const containerWidth = canvasContainer.offsetWidth;
                const containerHeight = canvasContainer.offsetHeight;

                console.log('Container dimensions:', containerWidth, 'x', containerHeight);

                // æ£€æŸ¥æ˜¯å¦å·²æœ‰canvasï¼Œå¦‚æœæœ‰åˆ™å¤ç”¨
                let canvas = canvasContainer.querySelector('canvas');
                if (!canvas) {
                    canvas = document.createElement('canvas');
                    canvasContainer.appendChild(canvas);
                }
                const ctx = canvas.getContext('2d');

                // è·å–å½“å‰é¡µé¢
                pdfDocument.getPage(currentSlideIndex + 1).then(function (page) {
                    const viewport = page.getViewport({ scale: 1 });

                    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ - å…¨å±æ¨¡å¼ä¸‹ä¼˜å…ˆæ’‘æ»¡
                    const scaleX = containerWidth / viewport.width;
                    const scaleY = containerHeight / viewport.height;

                    let scale;
                    let isWidthFit = false;

                    if (isPreviewMode) {
                        // å…¨å±é¢„è§ˆæ¨¡å¼ä¸‹ç¡®ä¿å†…å®¹å®Œå…¨æ˜¾ç¤ºåœ¨å®¹å™¨å†…
                        // é€‰æ‹©è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œç¡®ä¿å†…å®¹ä¸ä¼šè¶…å‡ºè¾¹ç•Œ
                        if (scaleX < scaleY) {
                            scale = scaleX * 0.95; // å®½åº¦é€‚é…ï¼Œç•™5%è¾¹è·
                            isWidthFit = true;
                        } else {
                            scale = scaleY * 0.95; // é«˜åº¦é€‚é…ï¼Œç•™5%è¾¹è·
                            isWidthFit = false;
                        }
                    } else {
                        // æ­£å¸¸æ¨¡å¼ä¸‹æ™ºèƒ½é€‚é…
                        const widthBasedScale = scaleX * 0.98;
                        const widthBasedHeight = viewport.height * widthBasedScale;

                        if (widthBasedHeight <= containerHeight) {
                            scale = widthBasedScale;
                            isWidthFit = true;
                        } else {
                            scale = scaleY * 0.98;
                            isWidthFit = false;
                        }
                    }

                    const scaledViewport = page.getViewport({ scale: scale });

                    // è®¾ç½®canvaså°ºå¯¸
                    canvas.width = scaledViewport.width;
                    canvas.height = scaledViewport.height;

                    // æ ¹æ®é€‚é…æ–¹å¼è®¾ç½®canvasæ ·å¼
                    if (isPreviewMode) {
                        // å…¨å±é¢„è§ˆæ¨¡å¼ä¸‹å±…ä¸­æ˜¾ç¤ºï¼Œç¡®ä¿å†…å®¹å®Œå…¨å¯è§
                        canvas.style.width = scaledViewport.width + 'px';
                        canvas.style.height = scaledViewport.height + 'px';
                        canvas.style.objectFit = 'none';
                        canvas.style.objectPosition = 'center center';
                        canvas.style.display = 'block';
                        canvas.style.margin = '0';
                        canvas.style.padding = '0';
                        canvas.style.position = 'absolute';
                        canvas.style.top = '50%';
                        canvas.style.left = '50%';
                        canvas.style.transform = 'translate(-50%, -50%)';
                        canvas.style.maxWidth = '100%';
                        canvas.style.maxHeight = '100%';
                    } else if (isWidthFit) {
                        // æ¨ªå‘æ’‘æ»¡
                        canvas.style.width = '100%';
                        canvas.style.height = 'auto';
                        canvas.style.display = 'block';
                        canvas.style.maxWidth = '100%';
                        canvas.style.maxHeight = '100%';
                        canvas.style.objectFit = 'contain';
                    } else {
                        // é«˜åº¦é€‚é…ï¼Œä¿æŒæ¯”ä¾‹
                        canvas.style.width = scaledViewport.width + 'px';
                        canvas.style.height = scaledViewport.height + 'px';
                        canvas.style.display = 'block';
                        canvas.style.maxWidth = '100%';
                        canvas.style.maxHeight = '100%';
                        canvas.style.objectFit = 'contain';
                    }

                    // ç¡®ä¿ä¸å‡ºç°æ»šè½®ä¸”å±…ä¸­æ˜¾ç¤º
                    if (isPreviewMode) {
                        // å…¨å±é¢„è§ˆæ¨¡å¼ä¸‹ç¡®ä¿å†…å®¹å®Œå…¨æ˜¾ç¤º
                        canvasContainer.style.overflow = 'hidden';
                        canvasContainer.style.alignItems = 'center';
                        canvasContainer.style.justifyContent = 'center';
                        canvasContainer.style.padding = '0';
                        canvasContainer.style.margin = '0';
                        canvasContainer.style.boxSizing = 'border-box';
                        canvasContainer.style.width = '100vw';
                        canvasContainer.style.height = '100vh';
                        canvasContainer.style.position = 'absolute';
                        canvasContainer.style.top = '0';
                        canvasContainer.style.left = '0';
                        canvasContainer.style.display = 'flex';

                        // æ·»åŠ æ·¡å…¥æ•ˆæœå‡å°‘é—ªåŠ¨
                        canvas.style.opacity = '0';
                        canvas.style.transition = 'opacity 0.2s ease-in-out';
                        setTimeout(() => {
                            canvas.style.opacity = '1';
                        }, 50);
                    } else {
                        // æ­£å¸¸æ¨¡å¼ä¸‹å±…ä¸­æ˜¾ç¤º
                        canvasContainer.style.overflow = 'hidden';
                        canvasContainer.style.alignItems = 'center';
                        canvasContainer.style.justifyContent = 'center';
                        canvasContainer.style.padding = '0';
                        canvasContainer.style.margin = '0';
                        canvasContainer.style.boxSizing = 'border-box';
                        canvasContainer.style.width = '100%';
                        canvasContainer.style.height = '100%';
                        canvasContainer.style.position = 'relative';
                    }

                    console.log('PDF dimensions:', scaledViewport.width, 'x', scaledViewport.height);
                    console.log('Container dimensions:', containerWidth, 'x', containerHeight);
                    console.log('Canvas style:', canvas.style.width, canvas.style.height);

                    // æ¸²æŸ“é¡µé¢
                    const renderContext = {
                        canvasContext: ctx,
                        viewport: scaledViewport
                    };

                    page.render(renderContext).promise.then(function () {
                        // æ›´æ–°é¡µç 
                        updateSlideCounter();

                        console.log('PDF rendered at scale:', scale);
                    });
                });
            }, 100);
        }

        // æ˜¾ç¤ºPPT
        function displayPPT() {
            if (isPdfMode) {
                displayPDF();
                return;
            }

            if (pptImages.length === 0) return;

            const pptViewer = document.getElementById('pptViewer');
            pptViewer.innerHTML = '';

            const imgElement = document.createElement('img');
            imgElement.src = pptImages[currentSlideIndex].src;
            imgElement.alt = `å¹»ç¯ç‰‡ ${currentSlideIndex + 1}`;
            imgElement.style.width = '100%';
            imgElement.style.height = '100%';
            imgElement.style.objectFit = 'contain';

            pptViewer.appendChild(imgElement);

            // æ›´æ–°é¡µç 
            updateSlideCounter();
        }

        // æ›´æ–°å¹»ç¯ç‰‡è®¡æ•°å™¨
        function updateSlideCounter() {
            const currentSlide = document.getElementById('currentSlide');
            const totalSlides = document.getElementById('totalSlides');

            currentSlide.textContent = currentSlideIndex + 1;

            if (isPdfMode && pdfDocument) {
                totalSlides.textContent = pdfDocument.numPages;
            } else {
                totalSlides.textContent = pptImages.length;
            }
        }

        // ä¸Šä¸€é¡µ
        function previousSlide() {
            if (isPdfMode && pdfDocument) {
                if (currentSlideIndex > 0) {
                    currentSlideIndex--;
                    displayPDF();
                }
            } else if (pptImages.length > 0) {
                currentSlideIndex = (currentSlideIndex - 1 + pptImages.length) % pptImages.length;
                displayPPT();
            }
        }

        // ä¸‹ä¸€é¡µ
        function nextSlide() {
            if (isPdfMode && pdfDocument) {
                if (currentSlideIndex < pdfDocument.numPages - 1) {
                    currentSlideIndex++;
                    displayPDF();
                }
            } else if (pptImages.length > 0) {
                currentSlideIndex = (currentSlideIndex + 1) % pptImages.length;
                displayPPT();
            }
        }

        // åˆ‡æ¢è§†é¢‘çª—å£å¤§å°
        function toggleVideoSize() {
            const videoWindow = document.getElementById('videoWindow');
            const video = document.getElementById('lectureVideo');
            const minimizeBtn = document.querySelector('.minimize-btn');

            if (isVideoMinimized) {
                // æ¢å¤åˆ°æ­£å¸¸å¤§å°
                videoWindow.style.width = '350px';
                videoWindow.style.height = '220px';
                video.style.display = 'block';
                minimizeBtn.textContent = 'âˆ’';
                isVideoMinimized = false;
            } else {
                // æœ€å°åŒ–
                videoWindow.style.width = '200px';
                videoWindow.style.height = '40px';
                video.style.display = 'none';
                minimizeBtn.textContent = 'â–¡';
                isVideoMinimized = true;
            }
        }

        // å…³é—­è§†é¢‘çª—å£
        function closeVideo() {
            const videoWindow = document.getElementById('videoWindow');
            const video = document.getElementById('lectureVideo');

            videoWindow.style.display = 'none';
            video.pause();
            video.src = '';
        }

        // è§†é¢‘çª—å£åˆå§‹åŒ–
        function initVideoWindow() {
            const videoWindow = document.getElementById('videoWindow');
            const dragBtn = document.querySelector('.drag-btn');

            // æ‹–åŠ¨æŒ‰é’®äº‹ä»¶
            dragBtn.addEventListener('mousedown', function (e) {
                isDragging = true;
                const rect = videoWindow.getBoundingClientRect();
                dragOffset.x = e.clientX - rect.left;
                dragOffset.y = e.clientY - rect.top;

                dragBtn.style.cursor = 'grabbing';
                videoWindow.classList.add('dragging');

                // é˜»æ­¢é»˜è®¤è¡Œä¸º
                e.preventDefault();
            });

            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
            document.addEventListener('mousemove', function (e) {
                if (!isDragging) return;

                const newLeft = e.clientX - dragOffset.x;
                const newTop = e.clientY - dragOffset.y;

                // è·å–å½“å‰è§†å£å¤§å°
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // é™åˆ¶åœ¨è§†å£å†…
                const maxLeft = viewportWidth - videoWindow.offsetWidth;
                const maxTop = viewportHeight - videoWindow.offsetHeight;

                const constrainedLeft = Math.max(0, Math.min(newLeft, maxLeft));
                const constrainedTop = Math.max(0, Math.min(newTop, maxTop));

                videoWindow.style.left = constrainedLeft + 'px';
                videoWindow.style.top = constrainedTop + 'px';
                videoWindow.style.right = 'auto';
                videoWindow.style.bottom = 'auto';
            });

            // é¼ æ ‡æ¾å¼€äº‹ä»¶
            document.addEventListener('mouseup', function () {
                if (isDragging) {
                    isDragging = false;
                    dragBtn.style.cursor = 'grab';
                    videoWindow.classList.remove('dragging');
                }
            });
        }

        // é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function (e) {
            if (e.key === 'ArrowLeft') {
                previousSlide();
            } else if (e.key === 'ArrowRight') {
                nextSlide();
            } else if (e.key === 'Escape') {
                closeModal();
            }
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.addEventListener('click', function (e) {
            const modal = document.getElementById('uploadModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
        const uploadArea = document.getElementById('uploadArea');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', function (e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function (e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function (e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');

                const files = e.dataTransfer.files;
                const fileInput = document.getElementById('fileInput');

                // æ¨¡æ‹Ÿæ–‡ä»¶è¾“å…¥
                const event = { target: { files: files, getAttribute: () => fileInput.getAttribute('data-type') } };
                handleFileUpload(event);
            });

            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©ï¼ˆlabelå·²ç»å¤„ç†äº†ç‚¹å‡»äº‹ä»¶ï¼‰
            // uploadArea.addEventListener('click', function() {
            //     document.getElementById('fileInput').click();
            // });
        }

        // é¢„è§ˆåŠŸèƒ½
        function togglePreview() {
            const previewBtn = document.querySelector('.preview-btn');
            const video = document.getElementById('lectureVideo');

            if (!isPreviewMode) {
                // å¼€å§‹é¢„è§ˆæ¨¡å¼
                isPreviewMode = true;
                previewBtn.textContent = 'åœæ­¢é¢„è§ˆ';
                previewBtn.classList.add('active');

                // æ£€æŸ¥æ˜¯å¦æœ‰PPTå’Œè§†é¢‘
                const hasPPT = (pptImages.length > 0 || (isPdfMode && pdfDocument));
                const hasVideo = video.src && video.src !== '';

                if (!hasPPT && !hasVideo) {
                    alert('è¯·å…ˆä¸Šä¼ PPTå’Œè§†é¢‘æ–‡ä»¶');
                    togglePreview(); // é‡ç½®çŠ¶æ€
                    return;
                }

                // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
                startPreview();

            } else {
                // åœæ­¢é¢„è§ˆæ¨¡å¼
                isPreviewMode = false;
                previewBtn.textContent = 'é¢„è§ˆ';
                previewBtn.classList.remove('active');

                // åœæ­¢è‡ªåŠ¨æ’­æ”¾
                stopPreview();
            }
        }

        // å¼€å§‹é¢„è§ˆ
        function startPreview() {
            const video = document.getElementById('lectureVideo');
            const videoWindow = document.getElementById('videoWindow');

            // ç¡®ä¿è§†é¢‘çª—å£æ˜¾ç¤º
            if (video.src && video.src !== '') {
                videoWindow.style.display = 'block';
            }

            // å¦‚æœæœ‰PPTå†…å®¹ï¼Œè¿›å…¥å…¨å±é¢„è§ˆ
            if ((isPdfMode && pdfDocument) || pptImages.length > 0) {
                enterFullscreenPreview();
            }

            // æ’­æ”¾è§†é¢‘ï¼ˆç‹¬ç«‹è¿è¡Œï¼Œä¸å½±å“PPTç¿»é¡µï¼‰
            if (video.src && video.src !== '') {
                // è®¾ç½®è§†é¢‘äº‹ä»¶ç›‘å¬ï¼Œç¡®ä¿è§†é¢‘æ“ä½œä¸å½±å“PPT
                video.addEventListener('play', function () {
                    // è§†é¢‘æ’­æ”¾æ—¶ä¸å½±å“PPTç¿»é¡µ
                });

                video.addEventListener('pause', function () {
                    // è§†é¢‘æš‚åœæ—¶ä¸å½±å“PPTç¿»é¡µ
                });

                video.addEventListener('seeked', function () {
                    // è§†é¢‘å¿«è¿›/åé€€æ—¶ä¸å½±å“PPTç¿»é¡µ
                });

                video.play().catch(e => {
                    console.log('è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', e);
                });
            }

            console.log('é¢„è§ˆæ¨¡å¼å·²å¯åŠ¨ - è§†é¢‘è‡ªåŠ¨æ’­æ”¾ï¼ŒPPTæ‰‹åŠ¨ç¿»é¡µ');
        }

        // åœæ­¢é¢„è§ˆ
        function stopPreview() {
            const video = document.getElementById('lectureVideo');
            const videoWindow = document.getElementById('videoWindow');

            // é€€å‡ºå…¨å±é¢„è§ˆ
            if ((isPdfMode && pdfDocument) || pptImages.length > 0) {
                exitFullscreenPreview();
            }

            // æ¢å¤è§†é¢‘çª—å£æ ·å¼
            videoWindow.classList.remove('fullscreen-preview');

            // æš‚åœè§†é¢‘ï¼ˆä½†ä¸å½±å“PPTçŠ¶æ€ï¼‰
            if (video.src && video.src !== '') {
                video.pause();
            }

            console.log('é¢„è§ˆæ¨¡å¼å·²åœæ­¢ - è§†é¢‘å·²æš‚åœ');
        }

        // è¿›å…¥å…¨å±é¢„è§ˆæ¨¡å¼
        function enterFullscreenPreview() {
            const pptContainer = document.querySelector('.ppt-container');
            const navbar = document.querySelector('.navbar');
            const videoWindow = document.getElementById('videoWindow');

            // éšè—å¯¼èˆªæ ï¼Œä½†ä¿æŒè§†é¢‘çª—å£å¯è§
            navbar.style.display = 'none';
            // ç¡®ä¿è§†é¢‘çª—å£åœ¨å…¨å±æ¨¡å¼ä¸‹å¯è§å¹¶åº”ç”¨å…¨å±æ ·å¼
            const video = document.getElementById('lectureVideo');
            if (video.src && video.src !== '') {
                videoWindow.style.display = 'block';
                videoWindow.classList.add('fullscreen-preview');
                // è®¾ç½®åˆå§‹ä½ç½®å’Œå°ºå¯¸ï¼Œé¿å…è¢«CSSè¦†ç›–
                videoWindow.style.position = 'absolute';
                videoWindow.style.top = '20px';
                videoWindow.style.right = '20px';
                videoWindow.style.width = '400px';
                videoWindow.style.height = '250px';
                videoWindow.style.resize = 'both';
                videoWindow.style.overflow = 'hidden';
                console.log('è§†é¢‘çª—å£å·²è®¾ç½®ä¸ºå…¨å±é¢„è§ˆæ¨¡å¼');
                // ç¡®ä¿è§†é¢‘ç»§ç»­æ’­æ”¾
                if (video.paused) {
                    video.play().catch(e => console.log('è§†é¢‘æ’­æ”¾å¤±è´¥:', e));
                }
            } else {
                console.log('æ²¡æœ‰è§†é¢‘æ–‡ä»¶ï¼Œè·³è¿‡è§†é¢‘çª—å£è®¾ç½®');
            }

            // æ·»åŠ å…¨å±ç±»åï¼Œå¯ç”¨æµ®åŠ¨æ§åˆ¶æ 
            pptContainer.classList.add('fullscreen');

            // ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿå…¨å±API
            if (!document.fullscreenElement) {
                pptContainer.requestFullscreen?.().then(() => {
                    console.log('å·²è¿›å…¥å…¨å±é¢„è§ˆæ¨¡å¼');
                    // å†æ¬¡ç¡®ä¿è§†é¢‘çª—å£æ˜¾ç¤º
                    if (video.src && video.src !== '') {
                        videoWindow.style.display = 'block';
                        videoWindow.classList.add('fullscreen-preview');
                        // é‡æ–°åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
                        initVideoWindow();
                    }
                }).catch(err => {
                    console.log('å…¨å±è¯·æ±‚å¤±è´¥:', err);
                    // å¦‚æœå…¨å±å¤±è´¥ï¼Œå›é€€åˆ°è‡ªå®šä¹‰å…¨å±
                    fallbackFullscreen();
                });
            }

            // æ·»åŠ é€€å‡ºå…¨å±çš„å¿«æ·é”®
            document.addEventListener('keydown', handleFullscreenKeydown);
            document.addEventListener('fullscreenchange', handleFullscreenChange);
        }

        // å›é€€åˆ°è‡ªå®šä¹‰å…¨å±æ¨¡å¼
        function fallbackFullscreen() {
            const pptViewer = document.getElementById('pptViewer');
            const pptContainer = document.querySelector('.ppt-container');
            const videoWindow = document.getElementById('videoWindow');

            // è®¾ç½®PPTå®¹å™¨ä¸ºå…¨å±
            pptContainer.style.position = 'fixed';
            pptContainer.style.top = '0';
            pptContainer.style.left = '0';
            pptContainer.style.width = '100vw';
            pptContainer.style.height = '100vh';
            pptContainer.style.zIndex = '9999';
            pptContainer.style.background = '#000';
            pptContainer.style.padding = '0';
            pptContainer.style.gap = '0';

            // æ·»åŠ å…¨å±ç±»åï¼Œå¯ç”¨æµ®åŠ¨æ§åˆ¶æ 
            pptContainer.classList.add('fullscreen');

            // è®¾ç½®PPTæŸ¥çœ‹å™¨ä¸ºå…¨å±
            pptViewer.style.borderRadius = '0';
            pptViewer.style.background = '#000';
            pptViewer.style.boxShadow = 'none';

            // éšè—PPTæ§åˆ¶æ 
            const pptControls = document.querySelector('.ppt-controls');
            if (pptControls) {
                pptControls.style.display = 'none';
            }

            // ç¡®ä¿è§†é¢‘çª—å£åœ¨å…¨å±æ¨¡å¼ä¸‹å¯è§å¹¶åº”ç”¨å…¨å±æ ·å¼
            const video = document.getElementById('lectureVideo');
            if (video.src && video.src !== '') {
                videoWindow.style.display = 'block';
                videoWindow.classList.add('fullscreen-preview');
                // ç¡®ä¿è§†é¢‘çª—å£å¯ä»¥è‡ªç”±æ‹–åŠ¨å’Œè°ƒæ•´å¤§å°
                videoWindow.style.position = 'absolute';
                videoWindow.style.resize = 'both';
                videoWindow.style.overflow = 'hidden';
                // é‡æ–°åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
                initVideoWindow();
                // ç¡®ä¿è§†é¢‘ç»§ç»­æ’­æ”¾
                if (video.paused) {
                    video.play().catch(e => console.log('è§†é¢‘æ’­æ”¾å¤±è´¥:', e));
                }
            }

            console.log('å·²è¿›å…¥è‡ªå®šä¹‰å…¨å±é¢„è§ˆæ¨¡å¼');
        }

        // é€€å‡ºå…¨å±é¢„è§ˆæ¨¡å¼
        function exitFullscreenPreview() {
            const pptContainer = document.querySelector('.ppt-container');
            const navbar = document.querySelector('.navbar');
            const videoWindow = document.getElementById('videoWindow');
            const pptViewer = document.getElementById('pptViewer');

            // ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿå…¨å±APIé€€å‡º
            if (document.fullscreenElement) {
                document.exitFullscreen?.().then(() => {
                    console.log('å·²é€€å‡ºå…¨å±é¢„è§ˆæ¨¡å¼');
                }).catch(err => {
                    console.log('é€€å‡ºå…¨å±å¤±è´¥:', err);
                });
            }

            // æ¢å¤å¯¼èˆªæ 
            navbar.style.display = 'flex';

            // æ¢å¤è§†é¢‘çª—å£æ ·å¼ï¼Œä½†ä¿æŒæ’­æ”¾çŠ¶æ€
            const video = document.getElementById('lectureVideo');
            if (video.src && video.src !== '') {
                videoWindow.style.display = 'block';
                videoWindow.classList.remove('fullscreen-preview');
                // ä¿æŒè§†é¢‘æ’­æ”¾çŠ¶æ€ï¼Œä¸æš‚åœ
            }

            // ç§»é™¤å…¨å±ç±»åï¼Œæ¢å¤æ§åˆ¶æ æ ·å¼
            pptContainer.classList.remove('fullscreen');

            // æ¢å¤PPTå®¹å™¨æ ·å¼
            pptContainer.style.position = '';
            pptContainer.style.top = '';
            pptContainer.style.left = '';
            pptContainer.style.width = '';
            pptContainer.style.height = '';
            pptContainer.style.zIndex = '';
            pptContainer.style.background = '';
            pptContainer.style.padding = '';
            pptContainer.style.gap = '';

            // æ¢å¤PPTæŸ¥çœ‹å™¨æ ·å¼
            pptViewer.style.borderRadius = '';
            pptViewer.style.background = '';
            pptViewer.style.boxShadow = '';

            // æ¢å¤PDFå®¹å™¨æ ·å¼
            const canvasContainer = pptViewer.querySelector('.pdf-canvas-container');
            if (canvasContainer) {
                canvasContainer.style.overflow = 'hidden';
                canvasContainer.style.width = '100%';
                canvasContainer.style.height = '100%';
                canvasContainer.style.position = 'relative';
                canvasContainer.style.top = '';
                canvasContainer.style.left = '';
                canvasContainer.style.alignItems = 'center';
                canvasContainer.style.justifyContent = 'center';
                canvasContainer.style.transform = '';

                // æ¢å¤canvasæ ·å¼
                const canvas = canvasContainer.querySelector('canvas');
                if (canvas) {
                    canvas.style.width = '';
                    canvas.style.height = '';
                    canvas.style.objectFit = '';
                    canvas.style.maxWidth = '';
                    canvas.style.maxHeight = '';
                    canvas.style.position = '';
                    canvas.style.top = '';
                    canvas.style.left = '';
                    canvas.style.transform = '';
                    canvas.style.opacity = '';
                    canvas.style.transition = '';
                }
            }

            // æ˜¾ç¤ºPPTæ§åˆ¶æ 
            const pptControls = document.querySelector('.ppt-controls');
            if (pptControls) {
                pptControls.style.display = 'flex';
            }

            // ç§»é™¤å…¨å±å¿«æ·é”®ç›‘å¬
            document.removeEventListener('keydown', handleFullscreenKeydown);
            document.removeEventListener('fullscreenchange', handleFullscreenChange);

            // é‡æ–°æ¸²æŸ“PDFä»¥ç¡®ä¿æ­£ç¡®æ˜¾ç¤º
            if (isPdfMode && pdfDocument) {
                setTimeout(() => {
                    displayPDF();
                }, 100);
            }

            console.log('å·²é€€å‡ºå…¨å±é¢„è§ˆæ¨¡å¼');
        }

        // å…¨å±æ¨¡å¼ä¸‹çš„é”®ç›˜äº‹ä»¶å¤„ç†
        function handleFullscreenKeydown(e) {
            if (e.key === 'Escape' || e.key === 'F11') {
                // ESCé”®æˆ–F11é”®é€€å‡ºå…¨å±
                if (isPreviewMode) {
                    togglePreview();
                }
            }
        }

        // å¤„ç†å…¨å±çŠ¶æ€å˜åŒ–
        function handleFullscreenChange() {
            if (!document.fullscreenElement) {
                // é€€å‡ºå…¨å±æ—¶æ¢å¤ç•Œé¢
                const pptContainer = document.querySelector('.ppt-container');
                const navbar = document.querySelector('.navbar');
                const videoWindow = document.getElementById('videoWindow');
                const pptControls = document.querySelector('.ppt-controls');

                // æ¢å¤å¯¼èˆªæ 
                navbar.style.display = 'flex';

                // æ¢å¤è§†é¢‘çª—å£æ ·å¼ï¼Œä½†ä¿æŒæ’­æ”¾çŠ¶æ€
                const video = document.getElementById('lectureVideo');
                if (video.src && video.src !== '') {
                    videoWindow.style.display = 'block';
                    videoWindow.classList.remove('fullscreen-preview');
                    // ä¿æŒè§†é¢‘æ’­æ”¾çŠ¶æ€ï¼Œä¸æš‚åœ
                }

                // ç§»é™¤å…¨å±ç±»åï¼Œæ¢å¤æ§åˆ¶æ æ ·å¼
                pptContainer.classList.remove('fullscreen');

                // æ¢å¤PPTæ§åˆ¶æ 
                if (pptControls) {
                    pptControls.style.display = 'flex';
                }

                if (isPreviewMode) {
                    // å¦‚æœä»åœ¨é¢„è§ˆæ¨¡å¼ï¼Œåœæ­¢é¢„è§ˆ
                    togglePreview();
                }
            }
        }

        // åˆ‡æ¢å…¨å±é¢„è§ˆæ¨¡å¼
        function toggleFullscreenPreview() {
            const pptContainer = document.querySelector('.ppt-container');

            if (!document.fullscreenElement) {
                // è¿›å…¥å…¨å±
                const navbar = document.querySelector('.navbar');
                const videoWindow = document.getElementById('videoWindow');

                // éšè—å¯¼èˆªæ ï¼Œä½†ä¿æŒè§†é¢‘çª—å£å¯è§
                navbar.style.display = 'none';
                // ç¡®ä¿è§†é¢‘çª—å£åœ¨å…¨å±æ¨¡å¼ä¸‹å¯è§å¹¶åº”ç”¨å…¨å±æ ·å¼
                const video = document.getElementById('lectureVideo');
                if (video.src && video.src !== '') {
                    videoWindow.style.display = 'block';
                    videoWindow.classList.add('fullscreen-preview');
                    // ç¡®ä¿è§†é¢‘çª—å£å¯ä»¥è‡ªç”±æ‹–åŠ¨å’Œè°ƒæ•´å¤§å°
                    videoWindow.style.position = 'absolute';
                    videoWindow.style.resize = 'both';
                    videoWindow.style.overflow = 'hidden';
                    // é‡æ–°åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
                    initVideoWindow();
                    // ç¡®ä¿è§†é¢‘ç»§ç»­æ’­æ”¾
                    if (video.paused) {
                        video.play().catch(e => console.log('è§†é¢‘æ’­æ”¾å¤±è´¥:', e));
                    }
                }

                // æ·»åŠ å…¨å±ç±»åï¼Œå¯ç”¨æµ®åŠ¨æ§åˆ¶æ 
                pptContainer.classList.add('fullscreen');

                // éšè—PPTæ§åˆ¶æ 
                const pptControls = document.querySelector('.ppt-controls');
                if (pptControls) {
                    pptControls.style.display = 'none';
                }

                // ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿå…¨å±API
                pptContainer.requestFullscreen?.().then(() => {
                    console.log('å·²è¿›å…¥å…¨å±é¢„è§ˆæ¨¡å¼');
                }).catch(err => {
                    console.log('å…¨å±è¯·æ±‚å¤±è´¥:', err);
                    // å¦‚æœå…¨å±å¤±è´¥ï¼Œå›é€€åˆ°è‡ªå®šä¹‰å…¨å±
                    fallbackFullscreen();
                });

                // æ·»åŠ é€€å‡ºå…¨å±çš„å¿«æ·é”®
                document.addEventListener('keydown', handleFullscreenKeydown);
                document.addEventListener('fullscreenchange', handleFullscreenChange);

            } else {
                // é€€å‡ºå…¨å±
                document.exitFullscreen?.().then(() => {
                    console.log('å·²é€€å‡ºå…¨å±é¢„è§ˆæ¨¡å¼');
                }).catch(err => {
                    console.log('é€€å‡ºå…¨å±å¤±è´¥:', err);
                });

                // æ¢å¤å¯¼èˆªæ 
                const navbar = document.querySelector('.navbar');
                navbar.style.display = 'flex';

                // æ¢å¤è§†é¢‘çª—å£æ ·å¼ï¼Œä½†ä¿æŒæ’­æ”¾çŠ¶æ€
                const videoWindow = document.getElementById('videoWindow');
                const video = document.getElementById('lectureVideo');
                if (video.src && video.src !== '') {
                    videoWindow.style.display = 'block';
                    videoWindow.classList.remove('fullscreen-preview');
                    // ä¿æŒè§†é¢‘æ’­æ”¾çŠ¶æ€ï¼Œä¸æš‚åœ
                }

                // ç§»é™¤å…¨å±ç±»åï¼Œæ¢å¤æ§åˆ¶æ æ ·å¼
                pptContainer.classList.remove('fullscreen');

                // æ¢å¤PPTæ§åˆ¶æ 
                const pptControls = document.querySelector('.ppt-controls');
                if (pptControls) {
                    pptControls.style.display = 'flex';
                }

                // æ¢å¤PPTå®¹å™¨æ ·å¼
                const pptViewer = document.getElementById('pptViewer');
                pptContainer.style.position = '';
                pptContainer.style.top = '';
                pptContainer.style.left = '';
                pptContainer.style.width = '';
                pptContainer.style.height = '';
                pptContainer.style.zIndex = '';
                pptContainer.style.background = '';
                pptContainer.style.padding = '';
                pptContainer.style.gap = '';

                // æ¢å¤PPTæŸ¥çœ‹å™¨æ ·å¼
                pptViewer.style.borderRadius = '';
                pptViewer.style.background = '';
                pptViewer.style.boxShadow = '';

                // ç§»é™¤å…¨å±å¿«æ·é”®ç›‘å¬
                document.removeEventListener('keydown', handleFullscreenKeydown);
                document.removeEventListener('fullscreenchange', handleFullscreenChange);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // åˆå§‹åŒ–è§†é¢‘çª—å£æ‹–æ‹½åŠŸèƒ½
            initVideoWindow();

            // æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬ï¼Œåœ¨é¢„è§ˆæ¨¡å¼ä¸‹é‡æ–°æ¸²æŸ“PDF
            window.addEventListener('resize', function () {
                if (isPreviewMode && isPdfMode && pdfDocument) {
                    // å»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…é¢‘ç¹é‡ç»˜
                    clearTimeout(window.resizeTimeout);
                    window.resizeTimeout = setTimeout(() => {
                        displayPDF();
                    }, 200);
                }
            });
        }); 
    </script>
</body>

</html>